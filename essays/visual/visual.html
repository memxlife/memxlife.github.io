<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Geometry Before Abstraction</title>

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <!-- Markdown renderer -->
  <script defer src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      max-width: 800px;
      margin: 60px auto;
      line-height: 1.6;
      color: #222;
    }
    h1 { font-size: 2.2em; }
    h2 { margin-top: 40px; }
    a { color: #0366d6; text-decoration: none; }
    a:hover { text-decoration: underline; }
    img { max-width: 100%; }
  </style>
</head>

<body>
  <div id="content">Loadingâ€¦</div>

  <script>
    async function render() {
      const res = await fetch('./visual.md', { cache: 'no-store' });
      if (!res.ok) {
        document.getElementById('content').textContent =
          `Failed to load visual.md (HTTP ${res.status}). Check file path.`;
        return;
      }

      const md = await res.text();

      // Remove YAML front matter if present
      const cleaned = md.replace(/^---[\s\S]*?---\s*/m, '');

      // Render Markdown -> HTML (marked is now guaranteed loaded)
      document.getElementById('content').innerHTML = marked.parse(cleaned);

      // Typeset math (MathJax is now guaranteed loaded)
      if (window.MathJax && MathJax.typesetPromise) {
        await MathJax.typesetPromise();
      }
    }

    // Ensure deferred scripts have loaded before calling marked.parse(...)
    window.addEventListener('DOMContentLoaded', () => {
      render().catch(err => {
        document.getElementById('content').textContent =
          'Render error. Open browser console for details.';
        console.error(err);
      });
    });
  </script>
</body>
</html>
